# Serverless - 01

- 서버가 아예 존재하지 않는 건 아님.
- 컴퓨터 또는 가상머신에 서버를 설정하고 그걸 통해서 일을 처리하는게 아니라는 의미.
  - '서버가 있긴 하지만 당신이 신경 쓸 건 거의 없어요' 쯤으로 받아들이면 될 듯.
  - 그럼 누가 신경씀? 하술할 BaaS 또는 FaaS가 해당 작업들을 수행함.
- BaaS(Backend as a Service), FaaS(Function as a Service)
  - BaaS : Firebase, etc...
  - FaaS : AWS Lambda, Azure, etc...



## 1. Old Technology

### a. fully-design the System

**그야말로 근본이자 시작점.** 시스템에 필요한 모든 것을 직접 설계하고 구성하며, 관리하는 단계.

여기서 '시스템에 필요한 것들'은 '전산실'이 대표함. 서버를 구성하기 위해 필요한 공간 + 컴퓨터 + 운영체제 + 네트워크 + ...등등 많은 요구사항들을 직접 관리하고 여러가지 문제에 대처하는 것. 이 경우 *시스템이 관리자에 의해 완전하게 통제된다.*는 장점이 있지만, 

<p style="color: crimson">"시스템의 규모가 커지면 컨트롤하기 점점 어려워지고, 별도의 관리자가 필요해질 수 있다."</p> 

는 치명적인 단점이 존재함.

### b. IaaS (Infrastructure as a Service)

본격적으로 '전산실'을 구성하고 관리해야만 가능한 일들을 대신할 수 있는 방법들이 등장하기 시작함. AWS(Amazone Web Service), Azure 등이 대표적인 예시. 전산실을 구성하는 데 필요한 공간이나 여러가지 문제들은 해당 회사들이 대신 구성해주고, 시스템을 구성하고자 하는 개발자는 이 서비스를 이용하면 됨. 

개발자가 해야할 일:

- 서비스를 이용하여, 하드웨어 / 네트워크 셋팅, 가상머신 구성 / 애플리케이션 설치 / OS 설치 등
  - 기존 하드웨어 및 공간까지 직접 마련하고, 셋팅하는 것에 비해 훨씬 편해졌다.
  - 그저 관리자패널을 이용하여 설정하기만 하면 된다.

### c. PaaS (Platform as a Service)

IaaS에서 더 추상화 된 모델로, 개발자가 애플리케이션만 올리면 바로 구동시킬 수 있는 서비스임. 네트워크 및 런타임까지 알아서 제공해주는 상태. AWS Elastic Beanstalk, Azure App Services 등이 여기에 해당하는 대표적인 예. 

- 이 서비스를 이용하면 Auto Scaling, Load Balancing 또한 손쉽다고 함. 그게 뭔지는 추후 공부할 것.



## 2. BaaS and FaaS

### a. BaaS (Backend as a Service)

#### first, what is Back-end?

- 간단하게, 완전히 가벼운 서비스가 아니라면, 대개의 서비스들은 프론트엔드(front-end)와 백엔드(back-end)로 나뉘어 구성된다.
  - 간단한 서비스는 단순 프로젝트 : 계산기, 그림판 등이 해당될 수 있다.
- 프론트엔드는 사용자로부터 입력받고, 기본적인 연산과 처리를 담당한다.
- 백엔드는 프론트엔드가 가공한 정보를 가지고 와 데이터베이스에 접근하고, 이를 저장하고, 처리하고, 다른 컴퓨터에 접근하고, 공유하는 등의 역할을 담당한다.
  - 사용자로부터 요청을 받아들이는 것이 프론트엔드라면,
  - 백엔드는 그 요청받은 것을 본격적으로 처리하고, 관리한다.

**중요한 점은**, 어떤 프로젝트(서비스)를 기획하던지 그 규모가 커지면 백엔드의 개발은 필연적이라는 것이다.

***

#### Then, what about BaaS?

이러한 백엔드, 서버를 개발하다보면 중요한 것 몇 가지를 신경써야 한다.

1. 어떤 컴퓨터를 써 서버를 구성해야 하는가
2. 서버에서 사용할 네트워크는 어떻게 할 것인가
3. 사용자가 늘어나면 무엇을, 얼마나 확장할 것인가
4. 서버의 보안은 어떻게 책임질 것인가

이런 상황에서 나온 것이, 해당 사항들을 대신 고려하고 처리해주며, 책임져주는 **BaaS, Firebase** 이다. (사실상 현재 생존한 유일한 BaaS가 Firebase 하나다.) 이를 통해 데이터베이스, 파일시스템, 소셜 서비스 연동 등을 그저 BaaS에서 (Firebase에서) 제공하는 API를 통해 전부 해 버릴 수 있다. 갑자기 사용량이 증가해도 알아서 확장해주고, 보안 역시 알아서 관리해준다.

#### BaaS(Firebase)'s pros and cons

pros

- 개발시간의 단축(인건비 절약)
  - 특히, Firebase에서는 실시간 db를 활용해 데이터의 생성 및 수정을 (웹소켓을 활용해) 클라이언트에 바로 반영시킬 수 있음.

cons

- 클라이언트 위주의 코드
  - 백앤드 서비스를 이용하는 것이기 때문에, 별도로 작업하지 않는 한 기본적으로 클라이언트 쪽에 백앤드 로직이 구현됨
    - Firebase의 경우, Firebase SDK를 이용해 서버단에서 구현할 수 있음
  - 데이터를 다루는 차원에서 로직 변경을 할 일이 있을 때, 재배포를 거쳐야 한다.
    - 웹앱이라면 JS를 새로
    - 모바일이라면 강제 업데이트가 필요해진다.
- 가격
  - 사용자가 많아지고, 전송하는 데이터의 양이 커지면 비싸진다.
  - 초반에는 무료지만, 규모가 커지면 감당하기 어려워지는 것.
    - 가격 청구는 수익 발생 전에 이뤄지ㄴ...
- ★ 복잡한 쿼리가 불가능: Firebase는 db가 하나의 큰 json 객체로 구조화되어 있음
  - 20/10/1~20/12/31 사이에 쓴 글 쿼리 : 가능
  - 'user'가 쓴 글 쿼리 : 가능
  - 20/10/1~20/12/31 사이에 'user'가 쓴 글 쿼리: 불가능
    - 이를 해결할려면, 작성시간+작성자를 한번에 다루는 새로운 필드가 필요해짐



### b. FaaS (Function as a Service)

프로젝트 > 함수(여러 개의 함수 or 한개의 큰 함수) 를 통해 거대한 컴퓨터에 함수를 등록하고, 실행함을 통해 서비스를 제공할 수 있게 해 주는 것.

해당 함수의 실행 조건으로 주기(하루에 한 번, 1시간에 한 번 등), 특정 이벤트(검색 시) 등을 설정할 수 있고, 콘솔을 통한 직접 호출 역시 가능함.

PaaS와 달리 서버 시스템에 신경쓰지 않아도 되고, 24시간 돌아가지 않음.

- PaaS는 지속적으로 돌아가기때문에, 그만큼의 비용이 발생
- FaaS는 함수를 호출할 때 비용을 부과하기 때문에, 호출되지 않으면 비용이 발생하지 않음.

이 경우에도, **거대한 컴퓨터를 제공하는 업체가 전산실에 해당하는 공간, 컴퓨터, 네트워크 등은 알아서 관리하기 때문에**, 그에 대한 걱정이나 확장에 대한 걱정은 하지 않아도 된다는 편리함이 있음.

물론, 단점도 존재.

1. 모든 코드를 함수로 쪼개서 작업 : 사용 가능한 자원에 제한
   - 항상 켜져야 하는 프로젝트는? FaaS인 AWS는 이를 위한 AWS IoT를 제공함. 즉, 대책도 FaaS 제공업체가 같이 줌ㅋㅋ.
2. FaaS 제공사에 의존하므로, 회사가 망하면 나도 망함.
   - 근데 아마존이 망할 리가 없음
3. 데이터를 로컬 스토리지에서 읽고 쓸 수 없음
   - 하지만 AWS의 경우 S3 스토리지처럼, 쓸 수 있는 스토리지를 제공함.
4. 신기술이라 어려움
   - 공부하면 댐

#### Use cases

- 서버의 백앤드를 FaaS로 구현
- 주기적인 크롤을 FaaS를 통해 구현
- 파일 처리, 로그 분석, 실시간 모니터링
- Netflix가 모든 작업을 FaaS(AWS)로 처리하기로 유명. (인코딩, 검증, 태깅, 공개, 백업 등)

